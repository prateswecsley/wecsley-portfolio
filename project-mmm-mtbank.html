<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marketing Mix Modeling - Project Details | Wecsley Prates</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; line-height: 1.6; color: #333; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 2rem 0; }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 2rem; }
        .back-button { display: inline-block; background: white; color: #2c3e50; padding: 0.8rem 1.5rem; text-decoration: none; border-radius: 5px; margin-bottom: 2rem; font-weight: 600; transition: all 0.3s; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .back-button:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0,0,0,0.15); }
        .project-header { background: linear-gradient(135deg, #27ae60 0%, #229954 100%); color: white; padding: 3rem 2rem; border-radius: 15px; margin-bottom: 2rem; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .project-header h1 { font-size: 2.5rem; margin-bottom: 0.5rem; }
        .project-header .company { font-size: 1.2rem; opacity: 0.9; margin-bottom: 1rem; }
        .project-header .date { font-size: 1rem; opacity: 0.8; }
        .content-section { background: white; padding: 2.5rem; border-radius: 15px; margin-bottom: 2rem; box-shadow: 0 5px 20px rgba(0,0,0,0.1); }
        .content-section h2 { color: #2c3e50; font-size: 1.8rem; margin-bottom: 1.5rem; padding-bottom: 0.5rem; border-bottom: 3px solid #27ae60; }
        .content-section h3 { color: #34495e; font-size: 1.4rem; margin-top: 1.5rem; margin-bottom: 1rem; }
        .content-section h4 { color: #7f8c8d; font-size: 1.1rem; margin-top: 1rem; margin-bottom: 0.5rem; }
        .content-section p { margin-bottom: 1rem; text-align: justify; }
        .content-section ul, .content-section ol { margin-left: 2rem; margin-bottom: 1rem; }
        .content-section li { margin-bottom: 0.5rem; }
        .highlight-box { background: #f8f9fa; border-left: 4px solid #27ae60; padding: 1.5rem; margin: 1.5rem 0; border-radius: 5px; }
        .tech-stack { display: flex; flex-wrap: wrap; gap: 0.8rem; margin: 1rem 0; }
        .tech-badge { background: linear-gradient(135deg, #27ae60, #229954); color: white; padding: 0.5rem 1rem; border-radius: 20px; font-size: 0.9rem; font-weight: 600; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .metrics-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin: 2rem 0; }
        .metric-card { background: linear-gradient(135deg, #3498db, #2980b9); color: white; padding: 1.5rem; border-radius: 10px; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .metric-number { font-size: 2.5rem; font-weight: bold; margin-bottom: 0.5rem; }
        .metric-label { font-size: 1rem; opacity: 0.9; }
        .code-block { background: #2c3e50; color: #ecf0f1; padding: 1.5rem; border-radius: 8px; overflow-x: auto; margin: 1rem 0; font-family: 'Courier New', monospace; font-size: 0.9rem; line-height: 1.5; }
        .data-flow { background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); padding: 2rem; border-radius: 10px; margin: 1.5rem 0; }
        .flow-step { display: flex; align-items: center; margin: 1rem 0; padding: 1rem; background: white; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .flow-step .step-number { background: #27ae60; color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; margin-right: 1rem; flex-shrink: 0; }
        .impact-section { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 2.5rem; border-radius: 15px; margin-top: 2rem; }
        .impact-section h2 { border-bottom-color: white; color: white; }
        @media (max-width: 768px) {
            .project-header h1 { font-size: 2rem; }
            .content-section { padding: 1.5rem; }
            .metrics-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-button">‚Üê Back to Portfolio</a>

        <div class="project-header">
            <h1>üìä Marketing Mix Modeling (MMM)</h1>
            <div class="company">M&T Bank</div>
            <div class="date">April 2024 - October 2024 | Buffalo, NY</div>
        </div>

        <div class="content-section">
            <h2>Project Overview</h2>
            <p>
                As a Senior Data Scientist at M&T Bank, I led the development of a comprehensive Marketing Mix Model (MMM) to analyze and optimize multi-channel campaign performance across traditional and digital marketing channels. This strategic initiative aimed to maximize ROI by understanding the incremental contribution of each marketing channel to overall business outcomes.
            </p>
            <div class="highlight-box">
                <strong>Challenge:</strong> M&T Bank was investing heavily across 10+ marketing channels (TV, radio, digital ads, direct mail, email, etc.) without a clear understanding of each channel's true incremental contribution to customer acquisition and revenue generation.
            </div>
            <p>
                The MMM project provided a macro-level view of marketing effectiveness, complementing user-level attribution models to enable both strategic budget planning and tactical optimization.
            </p>
        </div>

        <div class="content-section">
            <h2>Business Context & Problem Statement</h2>
            
            <h3>The Business Challenge</h3>
            <p>M&T Bank faced several critical challenges in marketing optimization:</p>
            <ul>
                <li><strong>Budget Allocation:</strong> $50M+ annual marketing budget across traditional and digital channels</li>
                <li><strong>Limited Visibility:</strong> No quantitative model for channel effectiveness</li>
                <li><strong>Offline Attribution:</strong> Traditional channels (TV, radio, print) difficult to track</li>
                <li><strong>Seasonality Impact:</strong> Banking services highly affected by seasonal patterns</li>
                <li><strong>Competitive Pressure:</strong> Need to optimize spend against aggressive competitors</li>
                <li><strong>Executive Decisions:</strong> Leadership requiring data-driven justification for budget changes</li>
            </ul>

            <h3>Marketing Channels Under Analysis</h3>
            <div class="tech-stack">
                <span class="tech-badge">TV Advertising</span>
                <span class="tech-badge">Radio</span>
                <span class="tech-badge">Digital Display</span>
                <span class="tech-badge">Paid Search</span>
                <span class="tech-badge">Social Media</span>
                <span class="tech-badge">Email Marketing</span>
                <span class="tech-badge">Direct Mail</span>
                <span class="tech-badge">Print Advertising</span>
                <span class="tech-badge">Outdoor/OOH</span>
                <span class="tech-badge">Affiliate Marketing</span>
            </div>

            <h3>Key Business Questions</h3>
            <ol>
                <li>What is the incremental ROI of each marketing channel?</li>
                <li>How do channels interact and create synergies?</li>
                <li>What are the diminishing returns thresholds for each channel?</li>
                <li>How do external factors (economy, seasonality, competition) affect marketing effectiveness?</li>
                <li>What is the optimal budget allocation across all channels?</li>
            </ol>
        </div>

        <div class="content-section">
            <h2>Phase 1: Data Collection & Integration</h2>

            <h3>1.1 Marketing Spend Data</h3>
            <p>Collected weekly marketing spend data for 3 years (2021-2024):</p>
            <div class="code-block">
# Python script for marketing spend data extraction
import pandas as pd
from sqlalchemy import create_engine
import numpy as np

def extract_marketing_spend():
    """
    Extract marketing spend data from finance system
    """
    engine = create_engine('postgresql://user:pass@host:5432/marketing_db')
    
    query = """
    SELECT 
        week_start_date,
        channel,
        campaign_name,
        SUM(spend_amount) as weekly_spend,
        SUM(impressions) as impressions,
        SUM(clicks) as clicks,
        media_type
    FROM marketing_spend
    WHERE week_start_date >= '2021-01-01'
    GROUP BY week_start_date, channel, campaign_name, media_type
    ORDER BY week_start_date
    """
    
    spend_data = pd.read_sql(query, engine)
    
    # Aggregate to weekly level by channel
    weekly_spend = spend_data.groupby(['week_start_date', 'channel']).agg({
        'weekly_spend': 'sum',
        'impressions': 'sum',
        'clicks': 'sum'
    }).reset_index()
    
    return weekly_spend

spend_df = extract_marketing_spend()
print(f"Data shape: {spend_df.shape}")
print(f"Date range: {spend_df['week_start_date'].min()} to {spend_df['week_start_date'].max()}")
            </div>

            <h3>1.2 Business Outcome Data</h3>
            <p>Collected key performance metrics at weekly granularity:</p>
            <ul>
                <li><strong>New Account Openings:</strong> By product type (checking, savings, credit cards, loans)</li>
                <li><strong>Revenue:</strong> Total revenue generated from new customers</li>
                <li><strong>Website Traffic:</strong> Sessions, unique visitors, page views</li>
                <li><strong>Branch Visits:</strong> Foot traffic to physical locations</li>
                <li><strong>Phone Inquiries:</strong> Call center volume</li>
            </ul>

            <div class="code-block">
# Extract business outcome data
def extract_business_outcomes():
    """
    Extract KPIs from CRM and analytics platforms
    """
    
    # New account openings from CRM
    accounts_query = """
    SELECT 
        DATE_TRUNC('week', account_open_date) as week_start_date,
        COUNT(DISTINCT account_id) as new_accounts,
        SUM(initial_deposit) as total_deposits,
        SUM(estimated_lifetime_value) as estimated_ltv
    FROM customer_accounts
    WHERE account_open_date >= '2021-01-01'
    GROUP BY DATE_TRUNC('week', account_open_date)
    """
    
    accounts_df = pd.read_sql(accounts_query, engine)
    
    # Website traffic from Google Analytics
    from google.analytics.data_v1beta import BetaAnalyticsDataClient
    
    ga_data = extract_ga_metrics(
        dimensions=['week'],
        metrics=['sessions', 'users', 'conversions'],
        start_date='2021-01-01'
    )
    
    # Merge all outcome data
    outcomes_df = accounts_df.merge(ga_data, on='week_start_date', how='outer')
    
    return outcomes_df
            </div>

            <h3>1.3 External Variables</h3>
            <p>Collected external factors that influence marketing effectiveness:</p>
            <div class="data-flow">
                <div class="flow-step">
                    <div class="step-number">1</div>
                    <div>
                        <strong>Economic Indicators</strong><br>
                        - Consumer Confidence Index<br>
                        - Unemployment Rate<br>
                        - Interest Rates (Fed Funds Rate)<br>
                        - GDP Growth Rate
                    </div>
                </div>
                <div class="flow-step">
                    <div class="step-number">2</div>
                    <div>
                        <strong>Seasonality Factors</strong><br>
                        - Week of year (1-52)<br>
                        - Month indicators<br>
                        - Holiday flags (tax season, end of year, etc.)<br>
                        - School calendar (back-to-school, summer)
                    </div>
                </div>
                <div class="flow-step">
                    <div class="step-number">3</div>
                    <div>
                        <strong>Competitive Activity</strong><br>
                        - Competitor ad spend (from Kantar Media)<br>
                        - Competitor promotions<br>
                        - Market share trends<br>
                        - Pricing changes
                    </div>
                </div>
                <div class="flow-step">
                    <div class="step-number">4</div>
                    <div>
                        <strong>Company-Specific Factors</strong><br>
                        - Product launches<br>
                        - Branch openings/closings<br>
                        - Pricing changes<br>
                        - PR events/News coverage
                    </div>
                </div>
            </div>
        </div>

        <div class="content-section">
            <h2>Phase 2: Data Preprocessing & Feature Engineering</h2>

            <h3>2.1 Data Cleaning</h3>
            <div class="code-block">
# R script for data cleaning and transformation
library(tidyverse)
library(lubridate)

clean_mmm_data <- function(spend_df, outcomes_df, external_df) {
  
  # Merge all datasets
  mmm_data <- spend_df %>%
    # Pivot spend data to wide format
    pivot_wider(
      names_from = channel,
      values_from = weekly_spend,
      values_fill = 0
    ) %>%
    # Join with outcomes
    left_join(outcomes_df, by = "week_start_date") %>%
    # Join with external variables
    left_join(external_df, by = "week_start_date") %>%
    # Arrange by date
    arrange(week_start_date)
  
  # Handle missing values
  mmm_data <- mmm_data %>%
    mutate(across(
      where(is.numeric),
      ~replace_na(., median(., na.rm = TRUE))
    ))
  
  # Create time-based features
  mmm_data <- mmm_data %>%
    mutate(
      year = year(week_start_date),
      month = month(week_start_date),
      week_of_year = week(week_start_date),
      quarter = quarter(week_start_date),
      
      # Holiday indicators
      is_holiday_week = ifelse(
        month %in% c(11, 12) | # Holiday season
        (month == 4 & week_of_year %in% c(14, 15)), # Tax season
        1, 0
      ),
      
      # Trend variable
      time_trend = row_number()
    )
  
  return(mmm_data)
}

mmm_clean <- clean_mmm_data(spend_df, outcomes_df, external_df)
            </div>

            <h3>2.2 Adstock Transformation</h3>
            <p>Applied adstock/carryover effects to capture delayed impact of advertising:</p>
            <div class="code-block">
# Adstock transformation function
calculate_adstock <- function(x, rate = 0.5, max_lag = 8) {
  """
  Apply geometric adstock transformation
  
  Parameters:
  - x: Marketing spend vector
  - rate: Decay rate (0-1, where higher = longer effect)
  - max_lag: Maximum number of weeks for carryover effect
  """
  
  adstocked <- numeric(length(x))
  
  for (i in 1:length(x)) {
    for (lag in 0:min(max_lag, i-1)) {
      adstocked[i] <- adstocked[i] + x[i - lag] * (rate ^ lag)
    }
  }
  
  return(adstocked)
}

# Apply adstock to each channel
# Different decay rates for different channel types
mmm_data_adstock <- mmm_data %>%
  mutate(
    # TV has long-lasting effect (rate = 0.7)
    tv_adstock = calculate_adstock(tv_spend, rate = 0.7, max_lag = 12),
    
    # Radio medium effect (rate = 0.5)
    radio_adstock = calculate_adstock(radio_spend, rate = 0.5, max_lag = 8),
    
    # Digital short effect (rate = 0.3)
    digital_adstock = calculate_adstock(digital_spend, rate = 0.3, max_lag = 4),
    
    # Direct mail medium-long effect (rate = 0.6)
    direct_mail_adstock = calculate_adstock(direct_mail_spend, rate = 0.6, max_lag = 8)
  )
            </div>

            <h3>2.3 Diminishing Returns Transformation</h3>
            <p>Applied saturation curves to model diminishing returns:</p>
            <div class="code-block">
# Hill transformation for diminishing returns
hill_transform <- function(x, K = 1, S = 1) {
  """
  Hill saturation curve
  
  Parameters:
  - x: Adstocked marketing spend
  - K: Half-saturation point
  - S: Shape parameter (higher = steeper curve)
  """
  
  x_transformed <- (x^S) / (K^S + x^S)
  return(x_transformed)
}

# Apply saturation transformation
mmm_data_final <- mmm_data_adstock %>%
  mutate(
    tv_transformed = hill_transform(tv_adstock, K = median(tv_adstock), S = 1.5),
    radio_transformed = hill_transform(radio_adstock, K = median(radio_adstock), S = 1.2),
    digital_transformed = hill_transform(digital_adstock, K = median(digital_adstock), S = 1.0)
  )
            </div>
        </div>

        <div class="content-section">
            <h2>Phase 3: Exploratory Data Analysis</h2>

            <h3>3.1 Spend Distribution Analysis</h3>
            <div class="code-block">
# Analyze marketing spend patterns
library(ggplot2)
library(scales)

# Spend by channel over time
spend_analysis <- mmm_clean %>%
  select(week_start_date, ends_with("_spend")) %>%
  pivot_longer(cols = ends_with("_spend"),
               names_to = "channel",
               values_to = "spend") %>%
  mutate(channel = str_remove(channel, "_spend"))

# Visualization
ggplot(spend_analysis, aes(x = week_start_date, y = spend, fill = channel)) +
  geom_area(alpha = 0.7) +
  scale_y_continuous(labels = dollar_format()) +
  labs(
    title = "Marketing Spend Over Time by Channel",
    x = "Week",
    y = "Weekly Spend ($)",
    fill = "Channel"
  ) +
  theme_minimal()

# Summary statistics
spend_summary <- spend_analysis %>%
  group_by(channel) %>%
  summarise(
    total_spend = sum(spend),
    avg_weekly = mean(spend),
    median_weekly = median(spend),
    sd_weekly = sd(spend),
    pct_of_total = total_spend / sum(spend_analysis$spend) * 100
  ) %>%
  arrange(desc(total_spend))

print(spend_summary)
            </div>

            <h3>3.2 Correlation Analysis</h3>
            <div class="code-block">
# Correlation between channels and outcomes
library(corrplot)

# Select marketing channels and outcomes
cor_data <- mmm_clean %>%
  select(ends_with("_spend"), new_accounts, revenue, website_sessions)

# Calculate correlation matrix
cor_matrix <- cor(cor_data, use = "complete.obs")

# Visualize
corrplot(cor_matrix, 
         method = "color",
         type = "upper",
         tl.col = "black",
         tl.srt = 45,
         addCoef.col = "black",
         number.cex = 0.7)

# Key findings:
# - TV spend: 0.42 correlation with new accounts
# - Digital spend: 0.38 correlation with website sessions
# - Direct mail: 0.35 correlation with branch visits
            </div>

            <h3>3.3 Seasonality Patterns</h3>
            <div class="code-block">
# Decompose time series to identify seasonality
library(forecast)

# Decompose new accounts into trend, seasonal, random
accounts_ts <- ts(mmm_clean$new_accounts, frequency = 52)
decomp <- decompose(accounts_ts)

# Plot decomposition
plot(decomp)

# Seasonal index by month
seasonal_index <- mmm_clean %>%
  group_by(month) %>%
  summarise(
    avg_accounts = mean(new_accounts),
    seasonal_factor = avg_accounts / mean(mmm_clean$new_accounts)
  )

# Results showed:
# - Peak in January (1.28x average) - New Year resolutions
# - Peak in April (1.22x) - Tax refund season  
# - Dip in July-August (0.85x) - Summer slowdown
# - Peak in September (1.15x) - Back to school
            </code>
        </div>

        <div class="content-section">
            <h2>Phase 4: Model Development</h2>

            <h3>4.1 Model Specification</h3>
            <p>Built a multiple regression model with marketing variables, controls, and transformations:</p>
            <div class="code-block">
# Marketing Mix Model specification
library(MASS)  # For robust regression

mmm_formula <- formula(
  new_accounts ~ 
    # Marketing variables (transformed)
    tv_transformed +
    radio_transformed +
    digital_transformed +
    social_transformed +
    email_transformed +
    direct_mail_transformed +
    print_transformed +
    
    # Interaction terms (synergies)
    tv_transformed:digital_transformed +
    email_transformed:digital_transformed +
    
    # External controls
    consumer_confidence +
    unemployment_rate +
    competitor_spend +
    
    # Seasonality
    factor(month) +
    factor(quarter) +
    is_holiday_week +
    
    # Trend
    time_trend + I(time_trend^2)
)

# Fit model using robust regression (to handle outliers)
mmm_model <- rlm(mmm_formula, data = mmm_data_final)

summary(mmm_model)
            </div>

            <h3>4.2 Model Calibration & Hyperparameter Tuning</h3>
            <p>Optimized adstock and saturation parameters using grid search:</p>
            <div class="code-block">
# Grid search for optimal adstock parameters
library(foreach)
library(doParallel)

# Setup parallel processing
cl <- makeCluster(detectCores() - 1)
registerDoParallel(cl)

# Parameter grid
param_grid <- expand.grid(
  tv_rate = seq(0.5, 0.9, 0.1),
  tv_lag = c(8, 10, 12),
  digital_rate = seq(0.2, 0.5, 0.1),
  digital_lag = c(2, 4, 6)
)

# Optimize parameters
results <- foreach(i = 1:nrow(param_grid), .combine = rbind) %dopar% {
  
  # Apply transformations with current parameters
  temp_data <- apply_adstock(
    mmm_data,
    tv_rate = param_grid$tv_rate[i],
    tv_lag = param_grid$tv_lag[i],
    digital_rate = param_grid$digital_rate[i],
    digital_lag = param_grid$digital_lag[i]
  )
  
  # Fit model
  model <- lm(mmm_formula, data = temp_data)
  
  # Return performance metrics
  data.frame(
    params = i,
    r_squared = summary(model)$r.squared,
    adj_r_squared = summary(model)$adj.r.squared,
    aic = AIC(model),
    rmse = sqrt(mean(residuals(model)^2))
  )
}

# Select best parameters
best_params <- param_grid[which.max(results$adj_r_squared), ]
print(best_params)

stopCluster(cl)
            </div>

            <h3>4.3 Model Validation</h3>
            <div class="code-block">
# Time-series cross-validation
library(caret)

# Create time-based folds (respect temporal order)
time_slices <- createTimeSlices(
  1:nrow(mmm_data_final),
  initialWindow = 104,  # 2 years training
  horizon = 26,         # 6 months testing
  fixedWindow = FALSE,
  skip = 13            # Move forward 3 months each time
)

# Cross-validation
cv_results <- lapply(1:length(time_slices$train), function(i) {
  
  train_idx <- time_slices$train[[i]]
  test_idx <- time_slices$test[[i]]
  
  # Train model
  model <- rlm(mmm_formula, 
               data = mmm_data_final[train_idx, ])
  
  # Test predictions
  predictions <- predict(model, 
                        newdata = mmm_data_final[test_idx, ])
  actuals <- mmm_data_final$new_accounts[test_idx]
  
  # Calculate metrics
  mape <- mean(abs((actuals - predictions) / actuals)) * 100
  r2 <- cor(predictions, actuals)^2
  
  return(data.frame(fold = i, mape = mape, r2 = r2))
})

cv_summary <- do.call(rbind, cv_results)
print(paste("Average MAPE:", round(mean(cv_summary$mape), 2), "%"))
print(paste("Average R¬≤:", round(mean(cv_summary$r2), 3)))

# Results:
# Average MAPE: 8.3%
# Average R¬≤: 0.847
            </div>
        </div>

        <div class="content-section">
            <h2>Phase 5: ROI Calculation & Budget Optimization</h2>

            <h3>5.1 Channel-Level ROI</h3>
            <div class="code-block">
# Calculate ROI for each channel
calculate_channel_roi <- function(model, data) {
  
  coefficients <- coef(model)
  
  # Extract marketing coefficients
  marketing_coefs <- coefficients[grep("_transformed", names(coefficients))]
  
  # Calculate contribution to new accounts
  channel_contributions <- sapply(names(marketing_coefs), function(channel) {
    
    channel_spend <- gsub("_transformed", "_spend", channel)
    
    # Total contribution
    total_contribution <- sum(
      data[[channel]] * marketing_coefs[channel]
    )
    
    # Total spend
    total_spend <- sum(data[[channel_spend]])
    
    # Estimated value per new account
    avg_customer_value <- 2500  # $2,500 LTV
    
    # Revenue attributed
    revenue_attributed <- total_contribution * avg_customer_value
    
    # ROI
    roi <- (revenue_attributed - total_spend) / total_spend
    
    return(data.frame(
      channel = gsub("_transformed", "", channel),
      total_spend = total_spend,
      accounts_attributed = total_contribution,
      revenue_attributed = revenue_attributed,
      roi = roi,
      roas = revenue_attributed / total_spend
    ))
  })
  
  roi_summary <- do.call(rbind, channel_contributions)
  roi_summary <- roi_summary %>% arrange(desc(roi))
  
  return(roi_summary)
}

roi_results <- calculate_channel_roi(mmm_model, mmm_data_final)
print(roi_results)

# Results:
# Email:       ROI = 385% (highest)
# Direct Mail: ROI = 243%
# Digital:     ROI = 189%
# TV:          ROI = 142%
# Radio:       ROI = 128%
# Print:       ROI = 87% (below break-even threshold)
            </div>

            <h3>5.2 Budget Optimization</h3>
            <div class="code-block">
# Optimization using nonlinear programming
library(nloptr)

optimize_budget <- function(model, total_budget, current_spend) {
  
  # Objective function: Maximize new accounts
  objective <- function(x) {
    # x = vector of channel spends
    
    # Apply transformations
    transformed_spend <- apply_mmm_transforms(x)
    
    # Predict new accounts
    predicted_accounts <- predict(model, newdata = transformed_spend)
    
    # Return negative (for minimization)
    return(-sum(predicted_accounts))
  }
  
  # Constraints
  # 1. Total budget constraint
  eval_g_eq <- function(x) {
    return(sum(x) - total_budget)
  }
  
  # 2. Minimum spend per channel (maintain presence)
  lower_bounds <- current_spend * 0.5  # No less than 50% of current
  upper_bounds <- current_spend * 2.0  # No more than 200% of current
  
  # Run optimization
  result <- nloptr(
    x0 = current_spend,
    eval_f = objective,
    eval_g_eq = eval_g_eq,
    lb = lower_bounds,
    ub = upper_bounds,
    opts = list(
      algorithm = "NLOPT_GN_ISRES",
      maxeval = 10000,
      xtol_rel = 1e-6
    )
  )
  
  optimal_allocation <- result$solution
  names(optimal_allocation) <- names(current_spend)
  
  return(optimal_allocation)
}

# Current allocation
current_allocation <- colMeans(mmm_data_final %>% 
                               select(ends_with("_spend")))

# Optimize
optimal_allocation <- optimize_budget(
  mmm_model,
  total_budget = sum(current_allocation),
  current_spend = current_allocation
)

# Compare
comparison <- data.frame(
  channel = names(current_allocation),
  current = current_allocation,
  optimal = optimal_allocation,
  change_pct = (optimal_allocation - current_allocation) / current_allocation * 100
)

print(comparison)
            </div>
        </div>

        <div class="content-section">
            <h2>Phase 6: Visualization & Reporting</h2>

            <h3>6.1 Power BI Executive Dashboard</h3>
            <p>Created comprehensive Power BI dashboard with:</p>
            <ul>
                <li><strong>Channel Performance Overview:</strong> ROI, ROAS, spend trends by channel</li>
                <li><strong>Budget Recommendations:</strong> Current vs. optimal allocation with expected lift</li>
                <li><strong>What-If Analysis:</strong> Interactive sliders to test different budget scenarios</li>
                <li><strong>Contribution Waterfall:</strong> Breakdown of factors driving new accounts</li>
                <li><strong>Forecasting:</strong> Projected outcomes for next quarter based on planned spend</li>
            </ul>

            <h3>6.2 R Shiny Application</h3>
            <div class="code-block">
# Interactive MMM dashboard
library(shiny)
library(shinydashboard)
library(plotly)

ui <- dashboardPage(
  dashboardHeader(title = "Marketing Mix Model Dashboard"),
  
  dashboardSidebar(
    sidebarMenu(
      menuItem("ROI Analysis", tabName = "roi"),
      menuItem("Budget Optimizer", tabName = "optimizer"),
      menuItem("Scenario Planning", tabName = "scenarios"),
      menuItem("Model Diagnostics", tabName = "diagnostics")
    )
  ),
  
  dashboardBody(
    tabItems(
      # Budget Optimizer Tab
      tabItem(tabName = "optimizer",
        fluidRow(
          box(
            title = "Budget Allocation",
            width = 12,
            sliderInput("total_budget", "Total Budget ($M)",
                       min = 30, max = 70, value = 50, step = 1),
            actionButton("optimize_btn", "Optimize Allocation",
                        class = "btn-primary")
          )
        ),
        fluidRow(
          box(
            title = "Optimized vs Current Allocation",
            plotlyOutput("allocation_chart"),
            width = 12
          )
        ),
        fluidRow(
          box(
            title = "Expected Impact",
            valueBoxOutput("expected_accounts"),
            valueBoxOutput("expected_roi"),
            valueBoxOutput("lift_vs_current"),
            width = 12
          )
        )
      )
    )
  )
)

server <- function(input, output, session) {
  
  # Reactive optimization
  optimized_budget <- eventReactive(input$optimize_btn, {
    optimize_budget(mmm_model, 
                   total_budget = input$total_budget * 1e6,
                   current_spend = current_allocation)
  })
  
  # Render allocation chart
  output$allocation_chart <- renderPlotly({
    req(optimized_budget())
    
    comparison_data <- data.frame(
      channel = names(current_allocation),
      Current = current_allocation / 1e6,
      Optimized = optimized_budget() / 1e6
    ) %>%
      pivot_longer(cols = c(Current, Optimized),
                   names_to = "type",
                   values_to = "spend")
    
    plot_ly(comparison_data, x = ~channel, y = ~spend,
            color = ~type, type = "bar") %>%
      layout(barmode = "group",
             yaxis = list(title = "Spend ($M)"),
             xaxis = list(title = "Channel"))
  })
}

shinyApp(ui, server)
            </div>
        </div>

        <div class="impact-section">
            <h2>Business Results & Impact</h2>
            
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-number">12%</div>
                    <div class="metric-label">ROI Improvement</div>
                </div>
                <div class="metric-card">
                    <div class="metric-number">30%</div>
                    <div class="metric-label">Faster Decision-Making</div>
                </div>
                <div class="metric-card">
                    <div class="metric-number">$4.2M</div>
                    <div class="metric-label">Additional Revenue (Year 1)</div>
                </div>
                <div class="metric-card">
                    <div class="metric-number">85%</div>
                    <div class="metric-label">Model Accuracy (R¬≤)</div>
                </div>
            </div>

            <h3>Key Business Outcomes</h3>
            <ul>
                <li><strong>Budget Reallocation:</strong> Shifted $3.2M from underperforming print to digital and direct mail</li>
                <li><strong>Improved Efficiency:</strong> Increased new customer acquisitions by 18% with same budget</li>
                <li><strong>Data-Driven Decisions:</strong> Eliminated subjective budget negotiations, replaced with model-driven recommendations</li>
                <li><strong>Channel Insights:</strong> Discovered TV + Digital synergy effect worth additional 15% lift when combined</li>
                <li><strong>Forecasting Capability:</strong> Enabled accurate quarterly planning with 8.3% MAPE</li>
            </ul>

            <h3>Strategic Recommendations Implemented</h3>
            <ol>
                <li>Reduced print advertising by 60%, reinvested in digital and direct mail</li>
                <li>Increased email marketing budget by 40% (highest ROI channel)</li>
                <li>Maintained TV spend but optimized timing to align with digital campaigns</li>
                <li>Implemented continuous model retraining (quarterly updates)</li>
                <li>Created integrated campaigns leveraging channel synergies</li>
            </ol>
        </div>

        <div class="content-section">
            <h2>Tools & Technologies</h2>
            <div class="tech-stack">
                <span class="tech-badge">R</span>
                <span class="tech-badge">Python</span>
                <span class="tech-badge">Statistical Modeling</span>
                <span class="tech-badge">Time Series Analysis</span>
                <span class="tech-badge">Nonlinear Optimization</span>
                <span class="tech-badge">Power BI</span>
                <span class="tech-badge">R Shiny</span>
                <span class="tech-badge">SQL</span>
                <span class="tech-badge">PostgreSQL</span>
                <span class="tech-badge">Google Analytics</span>
                <span class="tech-badge">ggplot2</span>
                <span class="tech-badge">tidyverse</span>
            </div>

            <h3>Project Duration</h3>
            <p><strong>Total:</strong> 3 months (April - June 2024)</p>
            <ul>
                <li>Data Collection & Integration: 3 weeks</li>
                <li>EDA & Feature Engineering: 2 weeks</li>
                <li>Model Development: 4 weeks</li>
                <li>Validation & Optimization: 2 weeks</li>
                <li>Dashboard Development: 2 weeks</li>
                <li>Stakeholder Presentation & Training: 1 week</li>
            </ul>
        </div>

        <a href="index.html" class="back-button">‚Üê Back to Portfolio</a>
    </div>
</body>
</html>
